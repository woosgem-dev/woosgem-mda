$schema: schemas/base/component.schema.yaml

component:
  name: Select
  category: molecule
  complexity: behavioral
  description: Dropdown selection component composed of trigger button, menu (listbox), and options. Supports single and multiple selection modes

semantics:
  tag: button
  role: combobox

attributes:
  variant:
    type: enum
    values: [outline, filled]
    default: outline
    description: Visual style variant of the trigger button
  size:
    type: enum
    values: [sm, md, lg]
    default: md
    description: Select component size applied to trigger, menu, and options
  disabled:
    type: boolean
    default: false
    description: Disabled state preventing all interaction
  error:
    type: boolean
    default: false
    description: Error validation state indicator
  open:
    type: boolean
    default: false
    description: Whether the dropdown menu is currently visible
  multiple:
    type: boolean
    default: false
    description: Enables multiple option selection mode

content:
  value:
    description: Display area for currently selected value text
    required: false
    type: text
    cardinality: single
  placeholder:
    description: Hint text shown when no value is selected
    required: false
    type: text
    cardinality: single
  icon:
    description: Dropdown arrow icon indicator
    required: false
    type: node
    cardinality: single

states:
  open:
    visual: Dropdown menu visible, trigger button shows active style
    behavior: Option navigation and selection enabled
    aria: { expanded: true }
  closed:
    visual: Dropdown menu hidden
    behavior: Trigger click or keyboard opens the menu
    aria: { expanded: false }
  error:
    visual: Border changes to error color
    behavior: Normal interaction with validation failure indication
    aria: {}
  disabled:
    visual: Reduced opacity
    behavior: All click and keyboard interaction blocked
    aria: { disabled: true }

interactions:
  toggle:
    triggers: [click, Enter, Space]
    condition:
      all:
        - { attr: disabled, eq: false }
    effect: toggle
    description: Toggle dropdown menu open/close state
  select-option:
    triggers: [click, Enter]
    condition:
      all:
        - { attr: open, eq: true }
    effect: emit
    payload:
      value: string
      label: string
    description: Select an option from the dropdown list
  navigate:
    triggers: [ArrowUp, ArrowDown]
    condition:
      all:
        - { attr: open, eq: true }
    effect: set
    description: Move highlight between options using arrow keys
  close:
    triggers: [Escape, Tab, click-outside]
    condition:
      all:
        - { attr: open, eq: true }
    effect: set
    description: Close the dropdown menu and return focus to trigger

accessibility:
  aria:
    expanded: "Reflects open state as true/false"
    haspopup: "listbox"
    disabled: "Set when disabled=true"
    activedescendant: "Points to currently highlighted option ID"
  keyboard:
    Enter: "Closed: open menu. Open: select highlighted option"
    Space: "Closed: open menu. Open: select highlighted option"
    ArrowDown: "Move highlight to next option"
    ArrowUp: "Move highlight to previous option"
    Escape: "Close dropdown, return focus to trigger"
    Tab: "Close dropdown, move focus to next element"
    Home: "Move highlight to first option"
    End: "Move highlight to last option"
  focus: Focus ring on trigger button. When opened, first or selected option receives focus

visual_mapping:
  class: select
  data_attributes:
    data-variant:
      strategy: value-mapped
      source: variant
    data-size:
      strategy: value-mapped
      source: size
    data-state:
      strategy: priority-enum
      priority:
        - { when: { attr: disabled, eq: true }, value: disabled }
        - { when: { attr: error, eq: true }, value: error }
        - { when: { attr: open, eq: true }, value: open }
      fallback: absent
    data-multiple:
      strategy: present-when-true
      source: multiple

composition:
  layout: [SelectMenu, SelectOption]
  rendering:
    strategy: inline
    description: Menu renders adjacent to trigger button with CSS positioning
  dependencies:
    atoms: []
  communication:
    pattern: context
    shared_state: [size, open, multiple, disabled]

  sub_components:
    - name: SelectMenu
      tag: ul
      description: Dropdown listbox container holding option items
      required: true
      attributes:
        size:
          type: enum
          values: [sm, md, lg]
          default: md
          description: Menu size matching trigger size
        open:
          type: boolean
          default: false
          description: Menu visibility state
        multiple:
          type: boolean
          default: false
          description: Multiple selection mode
      content:
        default:
          description: SelectOption component list
          required: true
          type: component-list
          cardinality: multiple
          accepts: [SelectOption]
      visual_mapping:
        class: select-menu
        data_attributes:
          data-size:
            strategy: value-mapped
            source: size
          data-state:
            strategy: priority-enum
            priority:
              - { when: { attr: open, eq: true }, value: open }
            fallback: absent
      accessibility:
        aria:
          multiselectable: "Set when multiple=true"
        keyboard: {}
        focus: "First or selected option receives focus when menu opens"

    - name: SelectOption
      tag: li
      description: Individual selectable option item within the dropdown
      required: true
      attributes:
        size:
          type: enum
          values: [sm, md, lg]
          default: md
          description: Option size matching menu size
        selected:
          type: boolean
          default: false
          description: Whether this option is currently selected
        disabled:
          type: boolean
          default: false
          description: Disabled state for this individual option
        highlighted:
          type: boolean
          default: false
          description: Keyboard navigation highlight state
      content:
        default:
          description: Option text label
          required: true
          type: text
          cardinality: single
        checkmark:
          description: Selection checkmark icon for multiple selection mode
          required: false
          type: node
          cardinality: single
      visual_mapping:
        class: select-option
        data_attributes:
          data-size:
            strategy: value-mapped
            source: size
          data-state:
            strategy: priority-enum
            priority:
              - { when: { all: [{ attr: selected, eq: true }, { attr: disabled, eq: true }] }, value: selected-disabled }
              - { when: { attr: disabled, eq: true }, value: disabled }
              - { when: { attr: highlighted, eq: true }, value: highlighted }
              - { when: { attr: selected, eq: true }, value: selected }
            fallback: absent
      accessibility:
        aria:
          selected: "Reflects selected state"
          disabled: "Set when disabled=true"
        keyboard: {}
        focus: "Receives focus via arrow key navigation"

control:
  mode: both
  value:
    type: "string | string[]"
    description: Currently selected value (string for single, string[] for multiple mode)
  default_value:
    type: "string | string[]"
    description: Initial selected value for uncontrolled usage
  on_change:
    payload:
      value: "string | string[]"
      option: "{ value: string, label: string }"
    description: Fired when selected option changes

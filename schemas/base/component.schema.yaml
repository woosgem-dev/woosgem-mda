# schemas/component.schema.yaml
# Layer 0: Platform-agnostic component spec.
# Defines WHAT a component IS — not how it renders on any specific platform.
# Platform-specific mapping lives in Layer 1 specs (spec.web.yaml, spec.ios.yaml, spec.compose.yaml).
# Applies to: domains/*/*/spec.yaml

schema:
  version: 2.0.0
  layer: 0
  description: Platform-agnostic component definition — the semantic source of truth
  applies_to: domains/*/*/spec.yaml

# ─────────────────────────────────────────────
# SECTION 1: Required Top-Level Sections
# ─────────────────────────────────────────────

sections:
  component:
    required: true
    fields:
      name: { type: string, required: true, format: PascalCase }
      category: { type: enum, required: true, values: [atom, molecule, organism] }
      description: { type: string, required: true, language: english }
      complexity:
        type: enum
        required: true
        values: [simple, composite, behavioral]
        description: |
          simple — single-unit component with no internal state machine
          composite — sub-components but minimal behavior logic
          behavioral — complex state machine or side effects required
      platforms:
        type: "string[]"
        required: false
        default: [web, ios, android]
        description: "Platforms this component supports. Omit to support all."
      version: { type: string, required: false, format: semver }

  properties:
    required: true
    description: "Component configuration. Empty {} is valid for components with no configurable properties."

  slots:
    required: true
    description: "Content areas. Empty {} is valid for components with no content."

  states:
    required: true
    description: "Component states. Empty {} is valid for stateless components."

  behaviors:
    required: true
    description: "Semantic interactions. Empty {} is valid for non-interactive components."

  semantics:
    required: true
    description: "Abstract accessibility semantics (platform specs map these to ARIA/VoiceOver/TalkBack)"

  # Optional sections
  composition:
    required: false
    description: "Only for compound components with sub-components or external dependencies"

  control:
    required: false
    description: "Only for form components (Input, Select, Checkbox, Radio, Switch, Textarea)"

# ─────────────────────────────────────────────
# SECTION 2: Type Algebra
# ─────────────────────────────────────────────

type_algebra:
  description: "Closed set of allowed types for properties"

  primitives:
    boolean:
      description: "true or false"
      default_allowed: true
    string:
      description: "Any string value"
      default_allowed: true
      optional_constraints:
        pattern: "Regex pattern"
        format: "Named format (e.g., hex-color)"
    number:
      description: "Numeric value"
      default_allowed: true
      optional_constraints:
        min: "Minimum value"
        max: "Maximum value"
        step: "Step increment"

  constrained:
    enum:
      description: "One of a fixed set of string values"
      requires: [values]
      default_allowed: true
      example:
        type: enum
        values: [filled, outline, ghost, link]
        default: filled

  compound:
    union:
      description: "Multiple types accepted"
      requires: [types]
      example:
        type: union
        types: [string, number]
        default: ~

  special:
    callback:
      description: "Event handler / action closure"
      requires: [signature]
      example:
        type: callback
        signature: "(value: string) => void"

  null_and_undefined:
    description: "Use YAML null (~) for absent defaults. Never use the string 'undefined'."

# ─────────────────────────────────────────────
# SECTION 3: Property Definition
# ─────────────────────────────────────────────

property_definition:
  fields:
    type: { required: true, values: [enum, boolean, string, number, union] }
    values: { required: "when type=enum" }
    types: { required: "when type=union" }
    default: { required: true, description: "Use ~ (null) if no default" }
    description: { required: true, language: english }
    min: { required: false, applicable: "type=number" }
    max: { required: false, applicable: "type=number" }

# ─────────────────────────────────────────────
# SECTION 4: Slot Definition
# ─────────────────────────────────────────────

slot_definition:
  fields:
    description: { required: true, language: english }
    required: { required: true, type: boolean }
    type:
      required: true
      values: [text, node, component-list]
      description: |
        text — plain text only
        node — any renderable content (text, elements, components)
        component-list — specific component types only (e.g., Tab items)
    cardinality:
      required: false
      values: [single, multiple]
      default: single
    accepts:
      required: false
      description: "List of accepted component names when type=component-list"

# ─────────────────────────────────────────────
# SECTION 5: State Definition
# ─────────────────────────────────────────────

state_definition:
  fields:
    description: { required: true, type: string, language: english }
    behavior: { required: true, type: string, language: english }

# ─────────────────────────────────────────────
# SECTION 6: Behavior Definition (Semantic Interactions)
# ─────────────────────────────────────────────

behavior_definition:
  description: |
    Platform-agnostic interaction definitions using semantic trigger names.
    Platform specs map these to concrete events (click/tap/Enter/accessibilityActivate).

  fields:
    triggers:
      required: true
      type: "string[]"
      description: "Semantic trigger names — platform specs map these to native events"
      allowed_values:
        - primary-action       # click, tap, Enter, Space, accessibilityActivate
        - secondary-action     # right-click, long-press, context menu
        - hover-start          # mouseenter, pointer hover (no mobile equivalent)
        - hover-end            # mouseleave
        - focus-in             # focus, VoiceOver focus
        - focus-out            # blur, VoiceOver move away
        - dismiss              # Escape, swipe down, tap outside
        - value-change         # input change, slider move, toggle
        - submit               # form submit, Enter in input
        - scroll               # scroll event
        - drag-start           # drag begin
        - drag-end             # drag end
        - long-press           # long press / force touch
    condition:
      required: false
      type: structured
      description: "Machine-parseable condition, not natural language"
      syntax:
        all: "All conditions must be true (AND)"
        any: "At least one must be true (OR)"
        not: "Negation"
      example:
        condition:
          all:
            - { prop: loading, eq: false }
            - { prop: disabled, eq: false }
    effect:
      required: true
      type: enum
      values: [emit, toggle, set]
      description: |
        emit — fires an external callback
        toggle(field) — toggles an internal boolean property
        set(field, value) — sets an internal property to a value
    payload:
      required: "when effect=emit"
      type: map
      description: "Data emitted with the callback"
    description: { required: true, language: english }

# ─────────────────────────────────────────────
# SECTION 7: Semantics (Abstract Accessibility)
# ─────────────────────────────────────────────

semantics_definition:
  description: |
    Abstract accessibility semantics. Platform specs map these to concrete APIs:
    Web → ARIA roles/attributes, iOS → VoiceOver traits, Android → Semantics {}

  fields:
    role:
      type: enum
      required: true
      values:
        - button
        - link
        - checkbox
        - radio
        - switch
        - textbox
        - listbox
        - option
        - slider
        - tab
        - tabpanel
        - tablist
        - dialog
        - alert
        - progressbar
        - separator
        - img
        - none
      description: "Abstract role — platform specs map to native equivalents"
    label:
      type: string
      required: false
      description: "How the component is labeled for assistive technology"
      source: "Reference to a slot or property that provides the label"
    live:
      type: enum
      required: false
      values: [polite, assertive, off]
      description: "Live region announcement behavior"
    state_announcements:
      type: map
      required: false
      description: "State changes that should be announced"
      example:
        loading: "Loading"
        disabled: "Disabled"

# ─────────────────────────────────────────────
# SECTION 8: Composition (Compound Components)
# ─────────────────────────────────────────────

composition_definition:
  description: "For components with sub-components."

  fields:
    layout:
      required: true
      type: "string[]"
      description: "Ordered list of sub-component names that defines structure"
      example: [ModalHeader, ModalBody, ModalFooter]

    rendering:
      required: true
      fields:
        strategy:
          type: enum
          values: [inline, overlay]
          description: |
            inline — rendered in document flow
            overlay — rendered above other content (platform handles how)
        description: { type: string }

    dependencies:
      required: false
      type: map
      description: "External component dependencies by domain"
      example:
        atoms: [Overlay, Spinner]

    communication:
      required: false
      description: "How parent and children share state"
      fields:
        pattern:
          type: enum
          values: [context, events, props]
          description: |
            context — shared state via context/environment (React Context, CompositionLocal, @Environment)
            events — child emits events to parent
            props — parent passes state as props/parameters
        shared_state: { type: "string[]", description: "Properties shared with children" }

  sub_components:
    description: "Each sub-component is defined inline with its own mini-spec"
    required_fields:
      name: { type: string, format: PascalCase }
      description: { type: string, language: english }
      required: { type: boolean }
    optional_fields:
      properties: "Same schema as top-level properties"
      slots: "Same schema as top-level slots"

# ─────────────────────────────────────────────
# SECTION 9: Control (Form Components)
# ─────────────────────────────────────────────

control_definition:
  description: "Required for form components: Input, Textarea, Select, Checkbox, Radio, Switch"
  fields:
    mode:
      type: enum
      required: true
      values: [controlled-only, uncontrolled-only, both]
    value:
      required: true
      fields:
        type: { required: true }
        description: { required: true }
    default_value:
      required: "when mode=both or mode=uncontrolled-only"
      fields:
        type: { required: true }
        description: { required: true }
    on_change:
      required: true
      fields:
        payload: { required: true, type: map }
        description: { required: true }

# ─────────────────────────────────────────────
# SECTION 10: Language & Style Rules
# ─────────────────────────────────────────────

language_rules:
  all_text: english
  description_style: noun-phrase
  description_examples:
    good: "Primary interaction button with multiple visual variants and states"
    bad: "This is a button that can be used for primary interactions"
  no_ambiguous_words: ["usually", "sometimes", "might", "can be", "etc."]
  null_convention: "Use YAML null (~) for absent values. Never 'undefined' string."

# ─────────────────────────────────────────────
# SECTION 11: Validation Checklist
# ─────────────────────────────────────────────

validation_checklist:
  errors:
    - All required sections present (component, properties, slots, states, behaviors, semantics)
    - All property types from closed type algebra
    - All behavior conditions use structured syntax (not natural language)
    - All behaviors with effect=emit have payload defined
    - Semantic role is from allowed values list
    - Behavior triggers use semantic names from allowed_values list
    - Form components have control section
    - Compound components have composition section
    - All text in English
    - No YAML string "undefined" — use null (~)
    - No platform-specific terms (no HTML tags, CSS classes, ARIA attributes, Modifier chains)

  warnings:
    - Components with dependencies should declare them in composition.dependencies
    - Components with size enum should reference shared tokens
    - State definitions should have corresponding behavior triggers

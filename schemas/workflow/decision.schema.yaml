# schemas/workflow/decision.schema.yaml
# Workflow artifact: Architecture Decision Record (ADR) frontmatter format.
# Machine-parseable YAML frontmatter for decision markdown files.
# Source: docs/plans/2026-02-12-spec-driven-dev-workflow-design.md Section 4
# Applies to: domains/*/*/.decisions/*.md (YAML frontmatter block)

schema:
  version: 1.0.0
  layer: workflow
  description: Architecture Decision Record — tracks why specs change with full traceability
  applies_to: domains/*/*/.decisions/*.md

# ─────────────────────────────────────────────
# SECTION 1: Decision Identity
# ─────────────────────────────────────────────

identity:
  fields:
    id:
      type: string
      required: true
      format: "NNN"
      description: "Numeric decision ID, zero-padded (e.g., 001, 012)"
    date:
      type: string
      required: true
      format: ISO-8601
      description: "Date the decision was made (e.g., 2026-02-12)"
    status:
      type: enum
      required: true
      values: [proposed, accepted, deprecated, superseded]
      description: |
        proposed — under discussion, not yet applied
        accepted — applied to spec, in effect
        deprecated — no longer relevant (component removed or redesigned)
        superseded — replaced by a newer decision (link via superseded_by)
    superseded_by:
      type: string
      required: false
      description: "ID of the decision that replaces this one (when status=superseded)"

# ─────────────────────────────────────────────
# SECTION 2: Traceability
# ─────────────────────────────────────────────

traceability:
  fields:
    component:
      type: string
      required: true
      format: PascalCase
      description: "Component this decision applies to"
    spec_revision_before:
      type: number
      required: true
      description: "Spec $revision before this decision was applied"
    spec_revision_after:
      type: number
      required: true
      description: "Spec $revision after this decision was applied"
    round:
      type: number
      required: true
      description: "Development loop round that triggered this decision"
    phase:
      type: enum
      required: true
      values: [spec-review, code-gen, senior-review, qa, parity]
      description: "Which phase produced the findings that led to this decision"
    finding_ids:
      type: "string[]"
      required: true
      description: "Finding IDs that triggered this decision (e.g., [F-001, F-002])"

# ─────────────────────────────────────────────
# SECTION 3: Decision Content
# ─────────────────────────────────────────────

content:
  fields:
    decision_type:
      type: enum
      required: true
      values: [behavior-clarification, edge-case, removal, addition]
      description: |
        behavior-clarification — clarifying ambiguous behavior
        edge-case — adding handling for an undocumented edge case
        removal — removing a feature or attribute from the spec
        addition — adding a new feature or attribute to the spec
    context:
      type: string
      required: true
      description: "Why this decision was needed — the problem or ambiguity"
    decision:
      type: string
      required: true
      description: "What was decided and how the spec was changed"
    consequences:
      type: "string[]"
      required: true
      description: "Downstream effects of this decision on code, tests, or other specs"

# ─────────────────────────────────────────────
# SECTION 4: Affected Scope
# ─────────────────────────────────────────────

scope:
  fields:
    affected_sections:
      type: "string[]"
      required: true
      description: "Spec sections modified (e.g., [interactions.activate, states.loading])"
    related_specs:
      type: "string[]"
      required: false
      description: "Other spec files affected by this decision (e.g., spec.react.yaml)"
    related_decisions:
      type: "string[]"
      required: false
      description: "IDs of related decisions for cross-reference"

# ─────────────────────────────────────────────
# SECTION 5: Document Structure
# ─────────────────────────────────────────────

document_structure:
  description: "Expected markdown structure after the YAML frontmatter"
  sections:
    - "# Decision: {title}"
    - "## Context"
    - "## Finding"
    - "## Decision"
    - "## Spec Change"
  note: "The YAML frontmatter (between --- delimiters) is validated by this schema. The markdown body follows a conventional structure but is not schema-validated."

# ─────────────────────────────────────────────
# SECTION 6: Conflict Resolution
# ─────────────────────────────────────────────

conflict_rules:
  description: "Priority order when multiple findings propose conflicting changes"
  priority:
    - "Security and accessibility issues override all others"
    - "Cross-component dependencies override single-component preferences"
    - "Later phases (QA) override earlier phases (spec-review)"
    - "Code reality (impl-discovered) overrides spec-review theory"
  escalation: "If two critical-severity findings contradict, escalate to human"
